# Security 関連の試験 Tips

最終編集日： 2025/11/04

## 「何を」保護し、「いつ」対応するか

Google Cloud のセキュリティシナリオ問題の多くは、「何を」保護し、「いつ」対応するかが問題となっている。
問題文を読んだら、まず以下の2つの軸で要件を分類するのが望ましい。これにより、無関係な選択肢を即座に除外できる。

### 「何を」保護するか？

セキュリティの対象は、大きく「設定（インフラ）」と「データ（中身）」の2つに分けられる。

* A. リソースと設定のセキュリティ (Security Posture)
  * これは、リソース（バケット、VM、ネットワークなど）が **「どのように構成されているか」** という問題です。

  * 主な問い: 
    * インフラの設定は安全か？
    * 推奨されるベストプラクティスに従っているか？
    * 脆弱な構成（例: パブリックアクセス、広すぎるファイアウォール、不十分なロギング）はないか？

  * 主な関連サービス:
    * **Security Command Center (SCC)**: 既知の脆弱性や設定ミスを検出し、セキュリティ体制を評価する
    * **組織のポリシー (Organization Policy)**: 特定の構成（例: 外部IPの付与）を禁止する
    * **VPC ファイアウォール / Cloud Armor**: ネットワークレベルのアクセスを制御・ブロックする

* B. データのセキュリティ (Data Protection)
  * これは、リソースの **「中に何が保存されているか」** という問題です。

  * 主な問い: 
    * どこに機密データ（PII, PCI, 医療情報）があるか？
    * そのデータは適切に分類・暗号化されているか？
    * データがマスキング（匿名化）されているか？

  * 主な関連サービス:
    * **Sensitive Data Protection (SDP / 旧 DLP)**: データの中身をスキャンして機密情報を検出し、分類し、マスキングする
    * **Cloud Key Management Service (KMS)**: データの暗号化に使用する鍵を管理する
    * **VPC Service Controls**: 承認されたネットワーク境界の外へデータが持ち出されるのを防ぐ

> [!TIP]
> 一例として GCS バケットで考えると、それぞれ以下のような機能の棲み分けとなる。
> 
> * SCC は「バケットが公開されていること（設定の問題）」を検出する
> * SDP は「公開バケットに機密データが含まれていること（データの問題）」を検出する

### 「いつ」対応するか？

「違反を防ぎたいのか（予防）」、それとも「違反を見つけたいのか（発見）」を判断する。

* A. 予防的統制 (Preventive Controls)
  * 違反やインシデントが発生するのを未然に防ぐための制御

  * キーワード: 
    * 防ぐ
    * 禁止する
    * 制限する
    * ～できないようにする準拠させる

  * 主な関連サービス:
    * **IAM (Identity and Access Management)**: 「誰が」「何を」できるかを定義し、不正な操作を防ぐ
    * **組織のポリシー (Organization Policy)**: 「リソースを特定リージョンのみに作成する」など、ポリシー違反の構成を禁止する
    * **VPC Service Controls**: サービス間のデータ移動を制限し、データ漏洩を防ぐ
    * **IAP (Identity-Aware Proxy)**: ゼロトラストモデルで、リソースへのアクセスを制御する

* B. 発見的統制 (Detective Controls)
  * 違反やインシデントが発生した（または、している）ことを見つけるための制御

  * キーワード: 
    * 見つける
    * 検出する
    * スキャンする
    * 特定する
    * アラートを上げる
    * 監査する

  * 主な関連サービス:
    * **Sensitive Data Protection (SDP)**: 既に保存されている非準拠の機密データを発見する
    * **Security Command Center (SCC)**: 構成ミスや脆弱性を発見する
    * **Cloud Logging**: 発生したイベント（API呼び出しなど）を記録し、レビューできるようにする
    * **Cloud Monitoring**: ログやメトリクスに基づいてアラートを上げる

* C. 修正的統制 (Corrective Controls)
  * 違反が発見された後に、それを自動的に修正・修復するための制御

  * キーワード:
    * 自動修復する
    * 修正する

  * 主な関連サービス:
    * **Cloud Functions / Cloud Run**: SCC の検出結果やログをトリガーにして、自動的に設定（例: 公開バケットを非公開にする）を修正するスクリプトを実行する

> [!TIP]
> 試験での応用
> 「EU域外のバケットに医療データが含まれているかを検出したい」
> 
> * 「含まれているか」 → データ (Data) の問題
> * 「検出したい」 → 発見 (Detective) の機能
> 
> このマトリクスから、**「データ」×「発見」** の領域が最も適切であり、その中核となるサービスは Sensitive Data Protection であると瞬時に判断できる

#### 【まとめ】
| 統制の機能 | 保護対象: 設定 (Security Posture) | 保護対象: データ (Data Protection) |
| :--- | :--- | :--- |
| **予防的統制**<br>*(Preventive)* | **目的:** 安全でない構成や違反ポリシーの作成を**未然に防ぐ**。<br><br>**キーワード:**「禁止する」「制限する」「防ぐ」「～できないようにする」<br><br>**主なサービス:**<br>• **IAM**: 権限のない操作を禁止<br>• **組織のポリシー**: 特定の構成（例: 外部IP）を禁止<br>• **VPC ファイアウォール**: 不正なネットワークアクセスをブロック<br>• **IAP**: ゼロトラストでリソースへのアクセスを制御 | **目的:** 機密データの不正な移動、漏洩、または不正アクセスを**未然に防ぐ**。<br><br>**キーワード:**「持ち出させない」「暗号化する」「マスキングする」<br><br>**主なサービス:**<br>• **VPC Service Controls**: サービス境界外へのデータ持ち出しを禁止<br>• **Cloud KMS**: データを暗号化して保護<br>• **Sensitive Data Protection**: データを保存 *前* にマスキング（匿名化）する |
| **発見的統制**<br>*(Detective)* | **目的:** 既存の設定ミス、脆弱性、コンプライアンス違反を**見つける**。<br><br>**キーワード:**「検出する」「スキャンする」「特定する」「アラート」<br><br>**主なサービス:**<br>• **Security Command Center (SCC)**: 構成ミスや脆弱性を検出<br>• **Cloud Logging**: 発生したイベント（API操作）を記録・監査<br>• **Cloud Monitoring**: 異常なアクティビティを監視しアラート | **目的:** *既に保存されている* 機密データ（PIIなど）がどこにあるか、または非準拠な状態（例: EU域外）かを**見つける**。<br><br>**キーワード:**「検出する」「分類する」「監査する」<br><br>**主なサービス:**<br>• **Sensitive Data Protection (SDP)**: バケットやDB内の機密データをスキャンして検出・分類<br>• **Cloud Logging**: データアクセス監査ログで「誰がデータにアクセスしたか」を監査 |


## Google Cloud データタイプ別 暗号化方式の適用範囲

この表は、Google Cloud のデータが「Google デフォルト暗号化」と「顧客管理の暗号化キー (CMEK)」のどちらで保護されるかを示します。

| データカテゴリ | 具体的なデータ例 | Google デフォルト暗号化<br>(Google-Managed) | CMEK<br>(Customer-Managed) | 「CMEK必須」要件での扱い |
| :--- | :--- | :--- | :--- | :--- |
| **ユーザーデータ (Data Plane)**<br>(顧客が所有・管理するデータ本体) | **Vertex AI:** トレーニングコード (GCS内) | **適用** (ベースライン) | **選択可能 (サポート対象)** | **CMEK を適用すべき対象** |
| | **Vertex AI:** トレーニングデータ (GCS, BQ内) | **適用** (ベースライン) | **選択可能 (サポート対象)** | **CMEK を適用すべき対象** |
| | **Vertex AI:** エクスポートされたモデル (GCS内) | **適用** (ベースライン) | **選択可能 (サポート対象)** | **CMEK を適用すべき対象** |
| | **Cloud Storage:** オブジェクトデータ | **適用** (ベースライン) | **選択可能 (サポート対象)** | **CMEK を適用すべき対象** |
| | **BigQuery:** テーブルデータ | **適用** (ベースライン) | **選択可能 (サポート対象)** | **CMEK を適用すべき対象** |
| | **Persistent Disk:** ディスクデータ | **適用** (ベースライン) | **選択可能 (サポート対象)** | **CMEK を適用すべき対象** |
| **サービスメタデータ (Control Plane)**<br>(サービス運用・管理のためのデータ) | **Vertex AI:** ジョブ名、ジョブの状態 | **適用** (必須) | **適用不可 (サポート対象外)** | 要件の**対象外** |
| | **BigQuery:** クエリテキスト、ジョブ履歴 | **適用** (必須) | **適用不可 (サポート対象外)** | 要件の**対象外** |
| | **Cloud Storage:** バケット名、オブジェクト名 | **適用** (必須) | **適用不可 (サポート対象外)** | 要件の**対象外** |
| | **すべてのサービス:** リソース名、ラベル、ID | **適用** (必須) | **適用不可 (サポート対象外)** | 要件の**対象外** |

**キーポイント:**

1.  **Google デフォルト暗号化**は、すべてのデータ（ユーザーデータとメタデータ）に対して常に適用されるベースラインの保護です。
2.  **CMEK** は、**ユーザーデータ (Data Plane)** に対して顧客が*追加で選択できる*オプションです。
3.  **サービスメタデータ (Control Plane)** は、Google がサービスを運用するために読み取る必要があるため、CMEK の**サポート対象外**です。

> [!TIP]
> 試験での応用
> 「サポートされているすべてのデータ型を CMEK で暗号化する」
> 
> * すべてのユーザーデータ（コード、データ、モデルなど）を CMEK で暗号化
> * メタデータはデフォルト暗号化のまま

## 暗号化についてまとめ

### 【暗号化の鍵にについて】

| 暗号化タイプ | 鍵の保管場所 | 鍵の管理責任者 | 利用するKMS | 例え（鍵のありか） |
| :--- | :--- | :--- | :--- | :--- |
| **デフォルト暗号化** | **GCP 内** (Google管理) | Google | (顧客からは見えない) | 銀行任せの**合鍵** |
| **CMEK**<br>(顧客管理キー) | **GCP 内** (Cloud KMS) | **顧客**<br>(KMS経由で) | **Cloud KMS** | 「鍵の管理室」に預けた鍵 |
| **CSEK**<br>(顧客指定キー) | **GCP 外** (顧客) | **顧客**<br>(リクエスト毎に鍵を供給) | (利用しない) | あなたが**ポケットに持つ**鍵 |
| **Cloud EKM**<br>(外部キー) | **GCP 外** (顧客の外部システム) | **顧客**<br>(外部システム経由で) | **Cloud KMS**<br>(外部への窓口として利用) | あなたの**自宅の金庫**にある鍵 |

> [!TIP]
> 試験での応用
> 「BigQuery、Cloud SQL、Cloud Storageに対する暗号化方式」
> 
> * CSEK は BigQuery と Cloud SQL でサポートされていないため注意が必要（Cloud Storage はサポート）

### 【鍵の管理方法について】

| サービス / 機能 | 役割（何をするものか） | 例え |
| :--- | :--- | :--- |
| **Cloud KMS**<br>(Key Management Service) | GCP**内**で鍵を安全に管理するための「サービス（場所）」です。<br>CMEK と EKM の両方で利用されます。 | 銀行の「鍵の管理室」 |
| **Cloud HSM**<br>(Hardware Security Module) | **CMEK のオプション**です。<br>Cloud KMS 内の鍵を、ソフトウェアではなく専用ハードウェアで保護する「保護レベル」の選択肢です。 | 「鍵の管理室」の**特別金庫** |

## Assured Workload 関連

| サービス名 | 例え（ハウスキーパー） | 機能（何をするか） | タイミング | Assured Workloads が必須か？ |
| :--- | :--- | :--- | :--- | :--- |
| **Assured Workloads** | 「特別なセキュリティ契約」付きの高級住宅地 | コンプライアンス体制（データ所在地、サポート担当者の場所など）の**パッケージを強制**する | 継続的 | - |
| **アクセスの透明性 (Access Transparency: AT)** | 家の「監視カメラ」 | Google 従業員によるデータアクセスを**監査・記録**する | 事後（検出） | **いいえ** (単体で利用可能) |
| **Access Approval (AA)** | 各部屋の「インターホンと電子錠」 | Google 従業員によるデータアクセスを**事前承認**する | 事前（予防） | **いいえ** (単体で利用可能) |
| **Key Access Justifications (KAJ)** | 「金庫の鍵」の管理台帳 | 暗号鍵（CMEK/EKM）へのアクセス理由を**監査・記録**する | 事後（検出） | **はい** (単体で利用不可) |

この表は、Assured Workloads がコンプライアンスの基盤となる「体制」そのものであり、AT、AA、KAJ はその体制内で Google 従業員の行動やアクセスを「監査」または「制御」するための具体的なツールであることを示しています。

### アクセスの透明性 (Access Transparency)

* 例え: 家のすべての部屋に設置された**「監視カメラ」**

* 役割: ハウスキーパー（Google 従業員）が、あなたの家（データ）のどこかの部屋に入室した（アクセスした）ら、その行動と理由（例: 「窓の清掃のため」）がすべて自動で録画され、あなたは後でその録画（ログ）を確認できます。

* 機能: 事後の監査（Detect）。「何が起こったか」を透明化します。

### Access Approval

* 例え: 各部屋のドアに取り付けられた**「インターホンと電子錠」**

* 役割: ハウスキーパーが部屋に入る前に、必ずインターホン（AA）であなたに**「入室許可」をリクエスト**します。あなたが「承認」ボタンを押さない限り、部屋のドアは解錠されず、ハウスキーパーは入室できません。

* 機能: 事前の承認（Prevent）。「これから入っても良いか」を制御します。

### Key Access Justifications (KAJ)

* 例え: 「金庫の鍵」の管理台帳

* 役割: ハウスキーパーが部屋（データ）に入るだけでなく、その中にある**「金庫の鍵（暗号鍵）」を使用しようとするたびに、「なぜその鍵が必要なのか（例: 「金庫の中身を点検するため」）」を台帳に詳細に記録**することを強制します。

* 機能: 鍵アクセスの理由を監査（Detect）。「なぜ鍵に触ったのか」を可視化します。

（EKM と組み合わせると、この台帳の理由を見てあなたが「承認/拒否」することも可能です）

### Assured Workloads

* 例え: 「特別なセキュリティ契約」付きの高級住宅地

* 役割: これは単一の機能ではなく、「パッケージ契約」です。あなたが「EU 担当者のみ」という契約で家（Assured Workloads フォルダ）を購入すると、以下のルールが自動的に強制されます。

  * この家（データ）は EU 圏内にしか建てられません（データ所在地）。
  * この家に出入りできるハウスキーパーは、EU 在住の担当者に限定されます（サポート担当者の場所）。
  * 上記の**「監視カメラ (AT)」「インターホン (AA)」「鍵の管理台帳 (KAJ)」**といった高度なセキュリティ設備が、標準で組み込まれます。

* 機能: コンプライアンス体制の強制。特定の規制（データ主権など）を満たすためのガードレールを自動で設定します。

  | 機能カテゴリ | できること（要約） |
  | :--- | :--- |
  | **データ所在地の強制** | リソース（データ）を指定した地理的リージョン（例: EU, US）**以外に作成できなくする**。 |
  | **担当者のアクセス制御** | Google のサポート担当者など、データにアクセスできる**中の人**を、指定した地域（例: EU 在住者）に**限定**する。 |
  | **コンプライアンスの自動化** | FedRAMP, IL4/5, EU データ主権など、特定の**規制パッケージ**に必要なセキュリティ設定を**自動で適用・強制**する。 |
  | **高度な機能の有効化** | **Key Access Justifications (KAJ)** のような、通常は使えない高度な暗号鍵の監査機能を**有効化**する。 |